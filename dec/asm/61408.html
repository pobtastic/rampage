<!DOCTYPE html>
<html>
<head>
<title>Rampage: Routine at 61408</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-wide.css" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-75RERFCHBG"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-75RERFCHBG');
</script>
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="61336.html">61336</a>
</td>
<td class="up">Up: <a href="../maps/all.html#61408">Map</a></td>
<td class="next">
Next: <a href="61710.html">61710</a>
</td>
</tr>
</table>
<div class="description">61408: Handler: Buildings</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="56951.html">RunHandlers</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="61408"></span>
<div class="comments">
<div class="paragraph">
This isn't so much a counter; it's more an address offset to select each buildings data in turn.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Handler_Buildings</td>
<td class="address-2"><span id="61408"></span>61408</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=0 (building data offset).</td>
</tr>
<tr>
<td class="asm-label">Handler_Buildings_Loop</td>
<td class="address-2"><span id="61409"></span>61409</td>
<td class="instruction">PUSH AF</td>
<td class="comment-1" rowspan="1">Stash the building data offset on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61410"></span>61410</td>
<td class="instruction">LD D,0</td>
<td class="comment-1" rowspan="2">Create an offset using <span class="register">DE</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61412"></span>61412</td>
<td class="instruction">LD E,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61413"></span>61413</td>
<td class="instruction">LD HL,54175</td>
<td class="comment-1" rowspan="4"><span class="register">IX</span>=<a href="54175.html">Table_Buildings</a>+building data offset.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61416"></span>61416</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61417"></span>61417</td>
<td class="instruction">PUSH HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61418"></span>61418</td>
<td class="instruction">POP IX</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61420"></span>61420</td>
<td class="instruction">LD A,(IX+0)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=building state (*<span class="register">IX</span>+0).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61423"></span>61423</td>
<td class="instruction">CP 2</td>
<td class="comment-1" rowspan="2">Jump to <a href="61408.html#61445">Handler_Buildings_0</a> if <span class="register">A</span> is equal to 2 (crashing).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61425"></span>61425</td>
<td class="instruction">JR Z,<a href="61408.html#61445">Handler_Buildings_0</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61427"></span>61427</td>
<td class="instruction">CP 3</td>
<td class="comment-1" rowspan="2">Jump to <a href="61408.html#61530">Sounds_BuildingCollapsing</a> if <span class="register">A</span> is equal to 3.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61429"></span>61429</td>
<td class="instruction">JP Z,<a href="61408.html#61530">Sounds_BuildingCollapsing</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61432"></span>61432</td>
<td class="instruction">CP 4</td>
<td class="comment-1" rowspan="2">Jump to <a href="61408.html#61611">Handler_Buildings_9</a> if <span class="register">A</span> is equal to 4</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61434"></span>61434</td>
<td class="instruction">JP Z,<a href="61408.html#61611">Handler_Buildings_9</a></td>
</tr>
<tr>
<td class="asm-label">Handler_Buildings_Next</td>
<td class="address-2"><span id="61437"></span>61437</td>
<td class="instruction">POP AF</td>
<td class="comment-1" rowspan="1">Restore the building data offset from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61438"></span>61438</td>
<td class="instruction">ADD A,14</td>
<td class="comment-1" rowspan="1">Move onto the next set of building data (offset+14).</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="61440"></span>
<div class="comments">
<div class="paragraph">
Have we accounted for all the buildings?
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61440"></span>61440</td>
<td class="instruction">CP 84</td>
<td class="comment-1" rowspan="2">Jump to <a href="61408.html#61409">Handler_Buildings_Loop</a> until <span class="register">A</span> is equal to 84.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61442"></span>61442</td>
<td class="instruction">JR NZ,<a href="61408.html#61409">Handler_Buildings_Loop</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61444"></span>61444</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
<tr>
<td class="asm-label">Handler_Buildings_0</td>
<td class="address-2"><span id="61445"></span>61445</td>
<td class="instruction">DEC (IX+13)</td>
<td class="comment-1" rowspan="1">Decrease *<span class="register">IX</span>+13 by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61448"></span>61448</td>
<td class="instruction">JP NZ,<a href="61408.html#61522">Sounds_BuildingCrumbling</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="61408.html#61522">Sounds_BuildingCrumbling</a> until *<span class="register">IX</span>+13 is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61451"></span>61451</td>
<td class="instruction">LD (IX+13),2</td>
<td class="comment-1" rowspan="1">Write 2 to *<span class="register">IX</span>+13.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61455"></span>61455</td>
<td class="instruction">DEC (IX+10)</td>
<td class="comment-1" rowspan="1">Decrease *<span class="register">IX</span>+10 by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61458"></span>61458</td>
<td class="instruction">JR NZ,<a href="61408.html#61500">Handler_Buildings_3</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="61408.html#61500">Handler_Buildings_3</a> until *<span class="register">IX</span>+10 is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61460"></span>61460</td>
<td class="instruction">LD (IX+0),3</td>
<td class="comment-1" rowspan="1">Write 3 to building state (*<span class="register">IX</span>+0).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61464"></span>61464</td>
<td class="instruction">LD A,(IX+5)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=*<span class="register">IX</span>+5.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61467"></span>61467</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="1">Increment <span class="register">A</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61468"></span>61468</td>
<td class="instruction">LD (IX+11),A</td>
<td class="comment-1" rowspan="1">Write <span class="register">A</span> to *<span class="register">IX</span>+11.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61471"></span>61471</td>
<td class="instruction">LD C,7</td>
<td class="comment-1" rowspan="1"><span class="register">C</span>=7.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61473"></span>61473</td>
<td class="instruction">LD A,(IX+7)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=*<span class="register">IX</span>+7.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61476"></span>61476</td>
<td class="instruction">RRCA</td>
<td class="comment-1" rowspan="1">Rotate <span class="register">A</span> right one position, setting the carry flag if bit 0 was set.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61477"></span>61477</td>
<td class="instruction">JR NC,<a href="61408.html#61481">Handler_Buildings_1</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="61408.html#61481">Handler_Buildings_1</a> if the carry flag is not set.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61479"></span>61479</td>
<td class="instruction">LD C,56</td>
<td class="comment-1" rowspan="1"><span class="register">C</span>=56.</td>
</tr>
<tr>
<td class="asm-label">Handler_Buildings_1</td>
<td class="address-2"><span id="61481"></span>61481</td>
<td class="instruction">LD E,(IX+1)</td>
<td class="comment-1" rowspan="1"><span class="register">E</span>=*<span class="register">IX</span>+1.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61484"></span>61484</td>
<td class="instruction">LD B,(IX+6)</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=*<span class="register">IX</span>+6.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61487"></span>61487</td>
<td class="instruction">LD HL,54047</td>
<td class="comment-1" rowspan="2"><span class="register">HL</span>=<a href="54047.html">54047</a>+<span class="register">DE</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61490"></span>61490</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="asm-label">Handler_Buildings_2</td>
<td class="address-2"><span id="61491"></span>61491</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=*<span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61492"></span>61492</td>
<td class="instruction">AND C</td>
<td class="comment-1" rowspan="1">Merge the bits from <span class="register">C</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61493"></span>61493</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Write <span class="register">A</span> to *<span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61494"></span>61494</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Increment <span class="register">HL</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61495"></span>61495</td>
<td class="instruction">DJNZ <a href="61408.html#61491">Handler_Buildings_2</a></td>
<td class="comment-1" rowspan="1">Decrease counter by one and loop back to <a href="61408.html#61491">Handler_Buildings_2</a> until counter is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61497"></span>61497</td>
<td class="instruction">JP <a href="61408.html#61611">Handler_Buildings_9</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="61408.html#61611">Handler_Buildings_9</a>.</td>
</tr>
<tr>
<td class="asm-label">Handler_Buildings_3</td>
<td class="address-2"><span id="61500"></span>61500</td>
<td class="instruction">LD L,(IX+10)</td>
<td class="comment-1" rowspan="1"><span class="register">L</span>=*<span class="register">IX</span>+10.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61503"></span>61503</td>
<td class="instruction">CALL <a href="61408.html#61679">Handler_Buildings_13</a></td>
<td class="comment-1" rowspan="1">Call <a href="61408.html#61679">Handler_Buildings_13</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61506"></span>61506</td>
<td class="instruction">LD E,L</td>
<td class="comment-1" rowspan="1"><span class="register">E</span>=<span class="register">L</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61507"></span>61507</td>
<td class="instruction">LD B,(IX+6)</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=*<span class="register">IX</span>+6.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61510"></span>61510</td>
<td class="instruction">LD C,255</td>
<td class="comment-1" rowspan="1"><span class="register">C</span>=255.</td>
</tr>
<tr>
<td class="asm-label">Handler_Buildings_4</td>
<td class="address-2"><span id="61512"></span>61512</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=*<span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61513"></span>61513</td>
<td class="instruction">OR %10000000</td>
<td class="comment-1" rowspan="1">Set bit 7.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61515"></span>61515</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Write <span class="register">A</span> to *<span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61516"></span>61516</td>
<td class="instruction">LD A,C</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=<span class="register">C</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61517"></span>61517</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-1" rowspan="1">Write <span class="register">A</span> to *<span class="register">DE</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61518"></span>61518</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Increment <span class="register">HL</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61519"></span>61519</td>
<td class="instruction">INC DE</td>
<td class="comment-1" rowspan="1">Increment <span class="register">DE</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61520"></span>61520</td>
<td class="instruction">DJNZ <a href="61408.html#61512">Handler_Buildings_4</a></td>
<td class="comment-1" rowspan="1">Decrease counter by one and loop back to <a href="61408.html#61512">Handler_Buildings_4</a> until counter is zero.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="61522"></span>
<div class="comments">
<div class="paragraph">
Plays a single building "crumbling" sound, the handler looping will keep it going until it's fallen and done.
</div>
<div class="paragraph">
<audio controls="" src="../../audio/building-crumbling.wav">
<p>Your browser doesn't support HTML5 audio. Here is a <a href="../../audio/building-crumbling.wav">link to the audio</a> instead.</p>
</audio>
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Sounds_BuildingCrumbling</td>
<td class="address-2"><span id="61522"></span>61522</td>
<td class="instruction">LD A,9</td>
<td class="comment-1" rowspan="2">Write melody ID 9 to *<a href="65280.html#65421">MelodyID</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61524"></span>61524</td>
<td class="instruction">LD (65421),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61527"></span>61527</td>
<td class="instruction">JP <a href="61408.html#61611">Handler_Buildings_9</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="61408.html#61611">Handler_Buildings_9</a>.</td>
</tr>
<tr>
<td class="asm-label">Sounds_BuildingCollapsing</td>
<td class="address-2"><span id="61530"></span>61530</td>
<td class="instruction">DEC (IX+13)</td>
<td class="comment-1" rowspan="1">Decrease *<span class="register">IX</span>+13 by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61533"></span>61533</td>
<td class="instruction">JR NZ,<a href="61408.html#61611">Handler_Buildings_9</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="61408.html#61611">Handler_Buildings_9</a> until *<span class="register">IX</span>+13 is zero.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="61535"></span>
<div class="comments">
<div class="paragraph">
Plays a single building "collapsing" sound, the handler looping will keep it going until it's fallen and done.
</div>
<div class="paragraph">
<audio controls="" src="../../audio/building-collapsing.wav">
<p>Your browser doesn't support HTML5 audio. Here is a <a href="../../audio/building-collapsing.wav">link to the audio</a> instead.</p>
</audio>
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61535"></span>61535</td>
<td class="instruction">LD A,8</td>
<td class="comment-1" rowspan="2">Write melody ID 8 to *<a href="65280.html#65421">MelodyID</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61537"></span>61537</td>
<td class="instruction">LD (65421),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61540"></span>61540</td>
<td class="instruction">LD (IX+13),2</td>
<td class="comment-1" rowspan="1">Write 2 to *<span class="register">IX</span>+13.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61544"></span>61544</td>
<td class="instruction">DEC (IX+11)</td>
<td class="comment-1" rowspan="1">Decrease *<span class="register">IX</span>+11 by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61547"></span>61547</td>
<td class="instruction">JR NZ,<a href="61408.html#61555">Handler_Buildings_5</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="61408.html#61555">Handler_Buildings_5</a> until *<span class="register">IX</span>+11 is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61549"></span>61549</td>
<td class="instruction">LD (IX+0),4</td>
<td class="comment-1" rowspan="1">Write 4 to building state (*<span class="register">IX</span>+0).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61553"></span>61553</td>
<td class="instruction">JR <a href="61408.html#61611">Handler_Buildings_9</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="61408.html#61611">Handler_Buildings_9</a>.</td>
</tr>
<tr>
<td class="asm-label">Handler_Buildings_5</td>
<td class="address-2"><span id="61555"></span>61555</td>
<td class="instruction">LD L,(IX+5)</td>
<td class="comment-1" rowspan="1"><span class="register">L</span>=*<span class="register">IX</span>+5.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61558"></span>61558</td>
<td class="instruction">DEC L</td>
<td class="comment-1" rowspan="1">Decrease <span class="register">L</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61559"></span>61559</td>
<td class="instruction">CALL <a href="61408.html#61679">Handler_Buildings_13</a></td>
<td class="comment-1" rowspan="1">Call <a href="61408.html#61679">Handler_Buildings_13</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61562"></span>61562</td>
<td class="instruction">ADD A,32</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>+=32.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61564"></span>61564</td>
<td class="instruction">LD E,A</td>
<td class="comment-1" rowspan="1"><span class="register">E</span>=<span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61565"></span>61565</td>
<td class="instruction">LD B,(IX+11)</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=*<span class="register">IX</span>+11.</td>
</tr>
<tr>
<td class="asm-label">Handler_Buildings_6</td>
<td class="address-2"><span id="61568"></span>61568</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="4">Stash <span class="register">BC</span>, <span class="register">HL</span> and <span class="register">DE</span> (twice) on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61569"></span>61569</td>
<td class="instruction">PUSH HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61570"></span>61570</td>
<td class="instruction">PUSH DE</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61571"></span>61571</td>
<td class="instruction">PUSH DE</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61572"></span>61572</td>
<td class="instruction">LD D,H</td>
<td class="comment-1" rowspan="1"><span class="register">D</span>=<span class="register">H</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61573"></span>61573</td>
<td class="instruction">LD E,L</td>
<td class="comment-1" rowspan="1"><span class="register">E</span>=<span class="register">L</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61574"></span>61574</td>
<td class="instruction">LD BC,32</td>
<td class="comment-1" rowspan="2"><span class="register">HL</span>+=0032.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61577"></span>61577</td>
<td class="instruction">ADD HL,BC</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61578"></span>61578</td>
<td class="instruction">LD B,(IX+6)</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=*<span class="register">IX</span>+6.</td>
</tr>
<tr>
<td class="asm-label">Handler_Buildings_7</td>
<td class="address-2"><span id="61581"></span>61581</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=*<span class="register">DE</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61582"></span>61582</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Write <span class="register">A</span> to *<span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61583"></span>61583</td>
<td class="instruction">INC E</td>
<td class="comment-1" rowspan="1">Increment <span class="register">E</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61584"></span>61584</td>
<td class="instruction">INC L</td>
<td class="comment-1" rowspan="1">Increment <span class="register">L</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61585"></span>61585</td>
<td class="instruction">DJNZ <a href="61408.html#61581">Handler_Buildings_7</a></td>
<td class="comment-1" rowspan="1">Decrease counter by one and loop back to <a href="61408.html#61581">Handler_Buildings_7</a> until counter is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61587"></span>61587</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">Restore <span class="register">HL</span> from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61588"></span>61588</td>
<td class="instruction">LD B,(IX+6)</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=*<span class="register">IX</span>+6.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61591"></span>61591</td>
<td class="instruction">LD C,255</td>
<td class="comment-1" rowspan="2">Write 255 to *<span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label">Handler_Buildings_8</td>
<td class="address-2"><span id="61593"></span>61593</td>
<td class="instruction">LD (HL),C</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61594"></span>61594</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Increment <span class="register">HL</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61595"></span>61595</td>
<td class="instruction">DJNZ <a href="61408.html#61593">Handler_Buildings_8</a></td>
<td class="comment-1" rowspan="1">Decrease counter by one and loop back to <a href="61408.html#61593">Handler_Buildings_8</a> until counter is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61597"></span>61597</td>
<td class="instruction">LD BC,32</td>
<td class="comment-1" rowspan="1"><span class="register">BC</span>=0032.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61600"></span>61600</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">Restore <span class="register">HL</span> from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61601"></span>61601</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Set flags.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61602"></span>61602</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>-=<span class="register">BC</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61604"></span>61604</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1">Exchange the <span class="register">DE</span> register with the shadow <span class="register">HL</span> register.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61605"></span>61605</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">Restore <span class="register">HL</span> from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61606"></span>61606</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>-=<span class="register">BC</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61608"></span>61608</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore <span class="register">BC</span> from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61609"></span>61609</td>
<td class="instruction">DJNZ <a href="61408.html#61568">Handler_Buildings_6</a></td>
<td class="comment-1" rowspan="1">Decrease counter by one and loop back to <a href="61408.html#61568">Handler_Buildings_6</a> until counter is zero.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="61611"></span>
<div class="comments">
<div class="paragraph">
Self-modifying code.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Handler_Buildings_9</td>
<td class="address-2"><span id="61611"></span>61611</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="2">Write 0 to *<a href="61408.html#61661">Handler_Buildings_11</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61612"></span>61612</td>
<td class="instruction">LD (61661),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61615"></span>61615</td>
<td class="instruction">DEC (IX+12)</td>
<td class="comment-1" rowspan="1">Decrease *<span class="register">IX</span>+12 by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61618"></span>61618</td>
<td class="instruction">JR NZ,<a href="61408.html#61636">Handler_Buildings_10</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="61408.html#61636">Handler_Buildings_10</a> until *<span class="register">IX</span>+12 is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61620"></span>61620</td>
<td class="instruction">LD (IX+0),5</td>
<td class="comment-1" rowspan="1">Write 5 to building state (*<span class="register">IX</span>+0).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61624"></span>61624</td>
<td class="instruction">LD A,(54259)</td>
<td class="comment-1" rowspan="3">Decrease *<a href="54259.html">BuildingsRemainingCount</a> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61627"></span>61627</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61628"></span>61628</td>
<td class="instruction">LD (54259),A</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="61631"></span>
<div class="comments">
<div class="paragraph">
Self-modifying code.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61631"></span>61631</td>
<td class="instruction">LD A,175</td>
<td class="comment-1" rowspan="2">Write 175 (XOR <span class="register">A</span>) to *<a href="61408.html#61661">Handler_Buildings_11</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61633"></span>61633</td>
<td class="instruction">LD (61661),A</td>
</tr>
<tr>
<td class="asm-label">Handler_Buildings_10</td>
<td class="address-2"><span id="61636"></span>61636</td>
<td class="instruction">LD L,(IX+5)</td>
<td class="comment-1" rowspan="1"><span class="register">L</span>=*<span class="register">IX</span>+5.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61639"></span>61639</td>
<td class="instruction">DEC L</td>
<td class="comment-1" rowspan="1">Decrease <span class="register">L</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61640"></span>61640</td>
<td class="instruction">CALL <a href="61408.html#61679">Handler_Buildings_13</a></td>
<td class="comment-1" rowspan="1">Call <a href="61408.html#61679">Handler_Buildings_13</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61643"></span>61643</td>
<td class="instruction">ADD A,32</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>+=32.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61645"></span>61645</td>
<td class="instruction">LD L,A</td>
<td class="comment-1" rowspan="1"><span class="register">L</span>=<span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61646"></span>61646</td>
<td class="instruction">LD E,A</td>
<td class="comment-1" rowspan="1"><span class="register">E</span>=<span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61647"></span>61647</td>
<td class="instruction">LD B,(IX+6)</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=*<span class="register">IX</span>+6.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61650"></span>61650</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1">Exchange the <span class="register">DE</span> register with the shadow <span class="register">HL</span> register.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61651"></span>61651</td>
<td class="instruction">LD A,(IX+12)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=*<span class="register">IX</span>+12.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61654"></span>61654</td>
<td class="instruction">AND %00000001</td>
<td class="comment-1" rowspan="1">Keep only bit 0.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61656"></span>61656</td>
<td class="instruction">ADD A,A</td>
<td class="comment-1" rowspan="3"><span class="register">A</span>*=8.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61657"></span>61657</td>
<td class="instruction">ADD A,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61658"></span>61658</td>
<td class="instruction">ADD A,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61659"></span>61659</td>
<td class="instruction">ADD A,68</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>+=68.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="61661"></span>
<div class="comments">
<div class="paragraph">
The value here is self-modified at: <table class="default">
<tr>
<th colspan="1" rowspan="1">Location</th>
<th colspan="1" rowspan="1">Value Set</th>
<th colspan="1" rowspan="1">Code</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="61408.html#61611">Handler_Buildings_9</a></td>
<td class="centre" colspan="1" rowspan="1">0</td>
<td class="centre" colspan="1" rowspan="1"><code>NOP</code></td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="61408.html#61631">61631</a></td>
<td class="centre" colspan="1" rowspan="1">175</td>
<td class="centre" colspan="1" rowspan="1"><code>XOR <span class="register">A</span></code></td>
</tr>
</table>
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Handler_Buildings_11</td>
<td class="address-2"><span id="61661"></span>61661</td>
<td class="instruction">NOP</td>
<td class="comment-1" rowspan="1">No operation OR <span class="register">A</span>=0 depending on the above.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61662"></span>61662</td>
<td class="instruction">LD (HL),255</td>
<td class="comment-1" rowspan="1">Write 255 to *<span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61664"></span>61664</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-1" rowspan="1">Write <span class="register">A</span> to *<span class="register">DE</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61665"></span>61665</td>
<td class="instruction">INC L</td>
<td class="comment-1" rowspan="1">Increment <span class="register">L</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61666"></span>61666</td>
<td class="instruction">INC E</td>
<td class="comment-1" rowspan="1">Increment <span class="register">E</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61667"></span>61667</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="1">Increment <span class="register">A</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61668"></span>61668</td>
<td class="instruction">CP 77</td>
<td class="comment-1" rowspan="2">Jump to <a href="61408.html#61674">Handler_Buildings_12</a> if <span class="register">A</span> is not equal to 77.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61670"></span>61670</td>
<td class="instruction">JR NZ,<a href="61408.html#61674">Handler_Buildings_12</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61672"></span>61672</td>
<td class="instruction">LD A,68</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=68.</td>
</tr>
<tr>
<td class="asm-label">Handler_Buildings_12</td>
<td class="address-2"><span id="61674"></span>61674</td>
<td class="instruction">DJNZ <a href="61408.html#61661">Handler_Buildings_11</a></td>
<td class="comment-1" rowspan="1">Decrease counter by one and loop back to <a href="61408.html#61661">Handler_Buildings_11</a> until counter is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61676"></span>61676</td>
<td class="instruction">JP <a href="61408.html#61437">Handler_Buildings_Next</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="61408.html#61437">Handler_Buildings_Next</a>.</td>
</tr>
<tr>
<td class="asm-label">Handler_Buildings_13</td>
<td class="address-2"><span id="61679"></span>61679</td>
<td class="instruction">LD H,0</td>
<td class="comment-1" rowspan="1"><span class="register">H</span>=0.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61681"></span>61681</td>
<td class="instruction">DEC L</td>
<td class="comment-1" rowspan="1">Decrease <span class="register">L</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61682"></span>61682</td>
<td class="instruction">ADD HL,HL</td>
<td class="comment-1" rowspan="5"><span class="register">HL</span>*=32.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61683"></span>61683</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61684"></span>61684</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61685"></span>61685</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61686"></span>61686</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61687"></span>61687</td>
<td class="instruction">LD E,(IX+3)</td>
<td class="comment-1" rowspan="1"><span class="register">E</span>=*<span class="register">IX</span>+3.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61690"></span>61690</td>
<td class="instruction">LD D,(IX+4)</td>
<td class="comment-1" rowspan="1"><span class="register">D</span>=*<span class="register">IX</span>+4.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61693"></span>61693</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>+=<span class="register">DE</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61694"></span>61694</td>
<td class="instruction">LD A,(IX+7)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=*<span class="register">IX</span>+7.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61697"></span>61697</td>
<td class="instruction">LD B,A</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=<span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61698"></span>61698</td>
<td class="instruction">ADD A,A</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>+=<span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61699"></span>61699</td>
<td class="instruction">ADD A,B</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>+=<span class="register">B</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61700"></span>61700</td>
<td class="instruction">ADD A,95</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>+=95.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61702"></span>61702</td>
<td class="instruction">LD B,A</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=<span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61703"></span>61703</td>
<td class="instruction">LD A,H</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=<span class="register">H</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61704"></span>61704</td>
<td class="instruction">SUB B</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>-=<span class="register">B</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61705"></span>61705</td>
<td class="instruction">ADD A,104</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>+=104.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61707"></span>61707</td>
<td class="instruction">LD D,A</td>
<td class="comment-1" rowspan="1"><span class="register">D</span>=<span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61708"></span>61708</td>
<td class="instruction">LD A,L</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=<span class="register">L</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="61709"></span>61709</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="61336.html">61336</a>
</td>
<td class="up">Up: <a href="../maps/all.html#61408">Map</a></td>
<td class="next">
Next: <a href="61710.html">61710</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&copy; 1986 Activision &copy; 2024 ArcadeGeek LTD.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 9.0.</div>
<div class="repository">Link to <a href="https://github.com/pobtastic/rampage/">Source code</a>.</div>
<div><a href="asm/61408.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>